import{b as O}from"./chunk-7JUMIBFN.js";import{a as Be,b as De}from"./chunk-4YE2IULK.js";import{L as xe,b as Ue,c as T,e as je,ea as $e,f as _e,fa as Le,h as Me,j as Re,k as Ae,l as Ne,m as ke,n as Oe}from"./chunk-BRWCKVVY.js";import{a as ge,b as Se,c as ve,d as Ee,e as k,f as ye,h as be,i as Fe,j as w,k as Ie,l as we,m as Te,n as Ce,o as S}from"./chunk-4IDIVDUM.js";import{$a as ue,Ba as ce,D as ie,Db as de,E as H,Fb as me,Ha as f,I as p,Ia as c,Ja as E,K as h,Kb as pe,L as F,M as a,O as oe,Oa as A,P as se,Sa as fe,T as ne,Xb as g,Za as m,a as W,aa as ae,ac as he,b as U,c as X,fb as le,g as j,h as I,hb as N,i as b,ja as l,k as L,ka as v,n as _,o as P,p as M,q as R,r as V,t as Z,u as Q,v as ee,va as Y,x as te,xa as d,y as G,z as re}from"./chunk-DHB3CJQD.js";import{a as C,g as y}from"./chunk-6DTZ7UCQ.js";var Pe=(()=>{let t=class t{constructor(){this._isUsedByNgShop$=new X(!1),this.isUsedByNgShop$=this._isUsedByNgShop$.asObservable()}setIsUsedByNgShop(){this._isUsedByNgShop$.next(!0)}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();var Qe={dispatch:!0,functional:!1,useEffectsErrorHandler:!0},x="__@ngrx/effects_create__";function B(e,t={}){let s=t.functional?e:e(),r=C(C({},Qe),t);return Object.defineProperty(s,x,{value:r}),s}function et(e){return Object.getOwnPropertyNames(e).filter(r=>e[r]&&e[r].hasOwnProperty(x)?e[r][x].hasOwnProperty("dispatch"):!1).map(r=>{let i=e[r][x];return C({propertyName:r},i)})}function tt(e){return et(e)}function Ve(e){return Object.getPrototypeOf(e)}function rt(e){return!!e.constructor&&e.constructor.name!=="Object"&&e.constructor.name!=="Function"}function Ge(e){return typeof e=="function"}function it(e){return e.filter(Ge)}function ot(e,t,s){let r=Ve(e),o=!!r&&r.constructor.name!=="Object"?r.constructor.name:null,n=tt(e).map(({propertyName:u,dispatch:$,useEffectsErrorHandler:Xe})=>{let J=typeof e[u]=="function"?e[u]():e[u],K=Xe?s(J,t):J;return $===!1?K.pipe(Q()):K.pipe(re()).pipe(b(Ze=>({effect:e[u],notification:Ze,propertyName:u,sourceName:o,sourceInstance:e})))});return P(...n)}var st=10;function He(e,t,s=st){return e.pipe(R(r=>(t&&t.handleError(r),s<=1?e:He(e,t,s-1))))}var Ye=(()=>{let t=class t extends W{constructor(r){super(),r&&(this.source=r)}lift(r){let i=new t;return i.source=this,i.operator=r,i}};t.\u0275fac=function(i){return new(i||t)(F(Ee))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function D(...e){return M(t=>e.some(s=>typeof s=="string"?s===t.type:s.type===t.type))}var qt=new h("@ngrx/effects Internal Root Guard"),zt=new h("@ngrx/effects User Provided Effects"),Jt=new h("@ngrx/effects Internal Root Effects"),Kt=new h("@ngrx/effects Internal Root Effects Instances"),Wt=new h("@ngrx/effects Internal Feature Effects"),Xt=new h("@ngrx/effects Internal Feature Effects Instance Groups"),nt=new h("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>He}),at="@ngrx/effects/init",ct=ge(at);function ft(e,t){if(e.notification.kind==="N"){let s=e.notification.value;!ut(s)&&t.handleError(new Error(`Effect ${lt(e)} dispatched an invalid action: ${dt(s)}`))}}function ut(e){return typeof e!="function"&&e&&e.type&&typeof e.type=="string"}function lt({propertyName:e,sourceInstance:t,sourceName:s}){let r=typeof t[e]=="function";return!!s?`"${s}.${String(e)}${r?"()":""}"`:`"${String(e)}()"`}function dt(e){try{return JSON.stringify(e)}catch{return e}}var mt="ngrxOnIdentifyEffects";function pt(e){return z(e,mt)}var ht="ngrxOnRunEffects";function gt(e){return z(e,ht)}var St="ngrxOnInitEffects";function vt(e){return z(e,St)}function z(e,t){return e&&t in e&&typeof e[t]=="function"}var qe=(()=>{let t=class t extends U{constructor(r,i){super(),this.errorHandler=r,this.effectsErrorHandler=i}addEffects(r){this.next(r)}toActions(){return this.pipe(G(r=>rt(r)?Ve(r):r),L(r=>r.pipe(G(Et))),L(r=>{let i=r.pipe(te(n=>yt(this.errorHandler,this.effectsErrorHandler)(n)),b(n=>(ft(n,this.errorHandler),n.notification)),M(n=>n.kind==="N"&&n.value!=null),ee()),o=r.pipe(Z(1),M(vt),b(n=>n.ngrxOnInitEffects()));return P(i,o)}))}};t.\u0275fac=function(i){return new(i||t)(F(ae),F(nt))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function Et(e){return pt(e)?e.ngrxOnIdentifyEffects():""}function yt(e,t){return s=>{let r=ot(s,e,t);return gt(s)?s.ngrxOnRunEffects(r):r}}var bt=(()=>{let t=class t{get isStarted(){return!!this.effectsSubscription}constructor(r,i){this.effectSources=r,this.store=i,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}};t.\u0275fac=function(i){return new(i||t)(F(qe),F(k))},t.\u0275prov=p({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function ze(...e){let t=e.flat(),s=it(t);return ne([s,{provide:oe,multi:!0,useValue:()=>{a(Se),a(ve,{optional:!0});let r=a(bt),i=a(qe),o=!r.isStarted;o&&r.start();for(let n of t){let u=Ge(n)?a(n):n;i.addEffects(u)}o&&a(k).dispatch(ct())}}])}var Je=(()=>{let t=class t{constructor(){this.actions$=a(Ye),this.authService=a(S),this.usersService=a(O),this.buildUserSession$=B(()=>this.actions$.pipe(D(be),V(()=>{if(this.authService.isValidToken()){let r=this.authService.getUserIdFromToken();return r?this.usersService.getUserById(r).pipe(b(i=>Fe({user:i})),R(()=>j(w()))):j(w())}else return j(w())}))),this.buildUserSessionFailed$=B(()=>this.actions$.pipe(D(w),H(()=>{localStorage.removeItem("jwtToken")})),{dispatch:!1}),this.userSessionLogout$=B(()=>this.actions$.pipe(D(Ie),H(()=>{localStorage.removeItem("jwtToken")})),{dispatch:!1})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=p({token:t,factory:t.\u0275fac});let e=t;return e})();var Ft=e=>({removeHeight:e}),Ke=e=>({submitted:e});function It(e,t){e&1&&(f(0,"small"),m(1,"Email is required!"),c())}function wt(e,t){e&1&&(f(0,"small"),m(1,"Email is not valid!"),c())}function Tt(e,t){e&1&&(f(0,"small"),m(1,"Password is required!"),c())}function Ct(e,t){e&1&&(f(0,"small"),m(1,"Minimum 6 characters!"),c())}var We=(()=>{let t=class t{constructor(r,i,o,n,u,$){this.formBuilder=r,this.authService=i,this.messageService=o,this.router=n,this.utilsService=u,this.usersService=$,this.form=this.formBuilder.group({email:["",[T.required,T.email]],password:["",[T.required,T.minLength(6)]]}),this.isSubmitted=!1,this.isPasswordShown=!1,this.isUsedByNgShop=!1,this.endSubs$=new U}ngOnInit(){this._checkFromNgShop(),this._getUsers()}_getUsers(){this.usersService.getUsers().subscribe({next:r=>{this.users=r},error:r=>{console.error("Cannot get users!",r)}})}onLoginFast(r){this.authService.loginFast(r.value).subscribe({next:i=>y(this,null,function*(){this.authService.setIsLoginFast(!0),this.authService.saveTokenLoginFast(i.token),this.messageService.add({severity:"success",summary:"Success",detail:"You are logged in successfully!"}),yield I(_(2e3)),this.router.navigateByUrl("/")}),error:i=>{console.error(i)}})}onSubmitLogin(){this.isSubmitted=!0,!this.form.invalid&&(this.isUsedByNgShop?this._loginNgShop():this._loginAdminPanel())}_loginAdminPanel(){this.authService.login(this.form.value).subscribe({next:r=>y(this,null,function*(){this.authService.saveTokenAdminPanel(r.token)?(this.messageService.add({severity:"success",summary:"Success",detail:"You are logged in successfully!"}),yield I(_(2e3)),this.router.navigateByUrl("/")):this.messageService.add({severity:"error",summary:"Error",detail:"You are not an admin!"})}),error:r=>{this.messageService.add({severity:"error",summary:"Error",detail:r.status!==400?"Server error, please try again later!":"Email or password incorrect"})}})}_loginNgShop(){this.authService.login(this.form.value).subscribe({next:r=>y(this,null,function*(){if(r&&r.token){this.authService.saveTokenNgShop(r.token);let i=this.authService.getUserIdFromToken();if(i){let o=this.usersService.getUserById(i),n=yield I(o);this.authService.loginNgShop(n),this.messageService.add({severity:"success",summary:"Success",detail:"You are logged in successfully!"}),yield I(_(2e3)),this.router.navigateByUrl("/")}}}),error:r=>{this.messageService.add({severity:"error",summary:"Error",detail:r.status!==400?"Server error, please try again later!":"Email or password incorrect"})}})}_checkFromNgShop(){this.utilsService.isUsedByNgShop$.pipe(ie(this.endSubs$)).subscribe({next:r=>{r&&(this.isUsedByNgShop=r)},error:r=>{console.error("Cannot get UsedByNgShop",r)}})}get formControls(){return this.form.controls}ngOnDestroy(){this.endSubs$.next(null),this.endSubs$.complete()}};t.\u0275fac=function(i){return new(i||t)(v(Ne),v(S),v(xe),v(g),v(Pe),v(O))},t.\u0275cmp=se({type:t,selectors:[["users-login"]],hostAttrs:[1,"full"],standalone:!0,features:[le],decls:34,vars:20,consts:[[1,"login-page",3,"ngClass"],[1,"login-container"],[1,"img"],["src","https://s3-bucket-gilshaashua.s3.eu-north-1.amazonaws.com/login.jpg","alt","login"],[1,"red-cover"],[1,"login-inner-container"],[1,"header"],[1,"form-login",3,"ngSubmit","formGroup"],[1,"email-input"],[1,"email"],["for","email"],[1,"pi","pi-user"],["formControlName","email","type","email","name","email","id","email","placeholder","Email",3,"ngClass"],[4,"ngIf"],[1,"password-input"],[1,"password"],["for","password"],[1,"pi","pi-ellipsis-h"],["formControlName","password","name","password","id","password","placeholder","Password",3,"type","ngClass"],[1,"eye","pi",3,"click","title"],["type","submit",1,"btn-login"],[1,"fast-login"],["optionLabel","name","optionValue","id","placeholder","Select a User",3,"onChange","options"],["position","bottom-center"]],template:function(i,o){i&1&&(f(0,"section",0)(1,"div",1)(2,"div",2),E(3,"img",3)(4,"div",4),c(),f(5,"div",5)(6,"div",6)(7,"h1"),m(8,"eShop"),c(),f(9,"h2"),m(10),c()(),f(11,"form",7),A("ngSubmit",function(){return o.onSubmitLogin()}),f(12,"div",8)(13,"div",9)(14,"label",10),E(15,"i",11),c(),E(16,"input",12),c(),Y(17,It,2,0,"small",13)(18,wt,2,0,"small",13),c(),f(19,"div",14)(20,"div",15)(21,"label",16),E(22,"i",17),c(),E(23,"input",18),f(24,"i",19),A("click",function(){return o.isPasswordShown=!o.isPasswordShown}),c()(),Y(25,Tt,2,0,"small",13)(26,Ct,2,0,"small",13),c(),f(27,"button",20),m(28,"Login"),c()(),f(29,"div",21)(30,"h3"),m(31,"Fast Login"),c(),f(32,"p-dropdown",22),A("onChange",function(u){return o.onLoginFast(u)}),c()()()()(),E(33,"p-toast",23)),i&2&&(d("ngClass",N(14,Ft,o.isUsedByNgShop)),l(10),ue(" ",o.isUsedByNgShop?"The best products in every category":"Admin Panel"," "),l(),d("formGroup",o.form),l(5),d("ngClass",N(16,Ke,o.isSubmitted)),l(),d("ngIf",o.formControls.email.hasError("required")&&o.isSubmitted),l(),d("ngIf",o.formControls.email.hasError("email")&&o.isSubmitted),l(5),fe("type",o.isPasswordShown?"text":"password"),d("ngClass",N(18,Ke,o.isSubmitted)),l(),ce(o.isPasswordShown?"pi-eye-slash":"pi-eye"),d("title",o.isPasswordShown?"Hide":"Show"),l(),d("ngIf",o.formControls.password.hasError("required")&&o.isSubmitted),l(),d("ngIf",o.formControls.password.hasError("minlength")&&o.isSubmitted),l(6),d("options",o.users))},dependencies:[pe,de,me,he,ke,Me,Ue,je,_e,Oe,Re,Ae,De,Be,Le,$e]});let e=t;return e})();var Mr=[{path:"",component:We,providers:[Ce,ye(we,Te),ze([Je])]}];function Or(){return y(this,null,function*(){let e=a(S),t=e.getToken();if(!t)return a(g).navigateByUrl("login"),!1;try{if(e.getIsLoginFast())return!0;let s=atob(t.split(".")[1]),r=JSON.parse(s);return r.isAdmin&&!e.isTokenExpried(r.exp)?!0:(a(g).navigateByUrl("login"),!1)}catch{return console.error("Error decoding JWT token"),a(g).navigateByUrl("login"),!1}})}function Pr(){let e=a(S),t=e.getToken();if(t){let s=atob(t.split(".")[1]),r=JSON.parse(s);return e.isTokenExpried(r.exp)?!0:(console.error("User is already logged in"),a(g).navigateByUrl("/"),!1)}else return!0}export{ze as a,Je as b,We as c,Mr as d,Or as e,Pr as f};
