import{A as ae,B as le,F as de,G as fe,I as f,K as c,L as a,M as u,N as _,O as M,Ob as me,T as N,V as pe,_ as he,a as T,b as se,ba as $,bc as Re,c as R,d as oe,e as ie,i as ce,pa as ge,sa as L,vb as ye,w as ue,zb as j}from"./chunk-DHB3CJQD.js";import{a as l,b as p}from"./chunk-6DTZ7UCQ.js";function P(e,t){let s=!t?.manualCleanup;s&&!t?.injector&&pe(P);let n=s?t?.injector?.get($)??u($):null,r;t?.requireSync?r=L({kind:0}):r=L({kind:1,value:t?.initialValue});let o=e.subscribe({next:i=>r.set({kind:1,value:i}),error:i=>{if(t?.rejectErrors)throw i;r.set({kind:2,error:i})}});return n?.onDestroy(o.unsubscribe.bind(o)),j(()=>{let i=r();switch(i.kind){case 1:return i.value;case 2:throw i.error;case 0:throw new fe(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}var K={};function S(e,t){if(K[e]=(K[e]||0)+1,typeof t=="function")return V(e,(...n)=>p(l({},t(...n)),{type:e}));switch(t?t._as:"empty"){case"empty":return V(e,()=>({type:e}));case"props":return V(e,n=>p(l({},n),{type:e}));default:throw new Error("Unexpected config.")}}function Z(){return{_as:"props",_p:void 0}}function V(e,t){return Object.defineProperty(t,"type",{value:e,writable:!1})}var _e="@ngrx/store/init",v=(()=>{let t=class t extends R{constructor(){super({type:_e})}next(n){if(typeof n=="function")throw new TypeError(`
        Dispatch expected an object, instead it received a function.
        If you're using the createAction function, make sure to invoke the function
        before dispatching the action. For example, someAction should be someAction().`);if(typeof n>"u")throw new TypeError("Actions must be objects");if(typeof n.type>"u")throw new TypeError("Actions must have a type property");super.next(n)}complete(){}ngOnDestroy(){super.complete()}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=f({token:t,factory:t.\u0275fac});let e=t;return e})(),Xe=[v],Me=new c("@ngrx/store Internal Root Guard"),Se=new c("@ngrx/store Internal Initial State"),Y=new c("@ngrx/store Initial State"),Ne=new c("@ngrx/store Reducer Factory"),ve=new c("@ngrx/store Internal Reducer Factory Provider"),$e=new c("@ngrx/store Initial Reducers"),z=new c("@ngrx/store Internal Initial Reducers"),be=new c("@ngrx/store Store Features"),Ee=new c("@ngrx/store Internal Store Reducers"),q=new c("@ngrx/store Internal Feature Reducers"),Fe=new c("@ngrx/store Internal Feature Configs"),Le=new c("@ngrx/store Internal Store Features"),Ie=new c("@ngrx/store Internal Feature Reducers Token"),Pe=new c("@ngrx/store Feature Reducers"),Te=new c("@ngrx/store User Provided Meta Reducers"),w=new c("@ngrx/store Meta Reducers"),je=new c("@ngrx/store Internal Resolved Meta Reducers"),we=new c("@ngrx/store User Runtime Checks Config"),xe=new c("@ngrx/store Internal User Runtime Checks Config"),E=new c("@ngrx/store Internal Runtime Checks"),Q=new c("@ngrx/store Check if Action types are unique"),B=new c("@ngrx/store Root Store Provider"),Ue=new c("@ngrx/store Feature State Provider");function W(e,t={}){let s=Object.keys(e),n={};for(let o=0;o<s.length;o++){let i=s[o];typeof e[i]=="function"&&(n[i]=e[i])}let r=Object.keys(n);return function(i,h){i=i===void 0?t:i;let d=!1,g={};for(let y=0;y<r.length;y++){let m=r[y],D=n[m],ne=i[m],re=D(ne,h);g[m]=re,d=d||re!==ne}return d?g:i}}function et(e,t){return Object.keys(e).filter(s=>s!==t).reduce((s,n)=>Object.assign(s,{[n]:e[n]}),{})}function Ve(...e){return function(t){if(e.length===0)return t;let s=e[e.length-1];return e.slice(0,-1).reduceRight((r,o)=>o(r),s(t))}}function ze(e,t){return Array.isArray(t)&&t.length>0&&(e=Ve.apply(null,[...t,e])),(s,n)=>{let r=e(s);return(o,i)=>(o=o===void 0?n:o,r(o,i))}}function tt(e){let t=Array.isArray(e)&&e.length>0?Ve(...e):s=>s;return(s,n)=>(s=t(s),(r,o)=>(r=r===void 0?n:r,s(r,o)))}var F=class extends T{},x=class extends v{},nt="@ngrx/store/update-reducers",U=(()=>{let t=class t extends R{get currentReducers(){return this.reducers}constructor(n,r,o,i){super(i(o,r)),this.dispatcher=n,this.initialState=r,this.reducers=o,this.reducerFactory=i}addFeature(n){this.addFeatures([n])}addFeatures(n){let r=n.reduce((o,{reducers:i,reducerFactory:h,metaReducers:d,initialState:g,key:y})=>{let m=typeof i=="function"?tt(d)(i,g):ze(h,d)(i,g);return o[y]=m,o},{});this.addReducers(r)}removeFeature(n){this.removeFeatures([n])}removeFeatures(n){this.removeReducers(n.map(r=>r.key))}addReducer(n,r){this.addReducers({[n]:r})}addReducers(n){this.reducers=l(l({},this.reducers),n),this.updateReducers(Object.keys(n))}removeReducer(n){this.removeReducers([n])}removeReducers(n){n.forEach(r=>{this.reducers=et(this.reducers,r)}),this.updateReducers(n)}updateReducers(n){this.next(this.reducerFactory(this.reducers,this.initialState)),this.dispatcher.next({type:nt,features:n})}ngOnDestroy(){this.complete()}};t.\u0275fac=function(r){return new(r||t)(a(x),a(Y),a($e),a(Ne))},t.\u0275prov=f({token:t,factory:t.\u0275fac});let e=t;return e})(),rt=[U,{provide:F,useExisting:U},{provide:x,useExisting:v}],X=(()=>{let t=class t extends se{ngOnDestroy(){this.complete()}};t.\u0275fac=(()=>{let n;return function(o){return(n||(n=he(t)))(o||t)}})(),t.\u0275prov=f({token:t,factory:t.\u0275fac});let e=t;return e})(),st=[X],A=class extends T{},Ae=(()=>{let t=class t extends R{constructor(n,r,o,i){super(i);let d=n.pipe(ie(oe)).pipe(de(r)),g={state:i},y=d.pipe(le(ot,g));this.stateSubscription=y.subscribe(({state:m,action:D})=>{this.next(m),o.next(D)}),this.state=P(this,{manualCleanup:!0,requireSync:!0})}ngOnDestroy(){this.stateSubscription.unsubscribe(),this.complete()}};t.INIT=_e,t.\u0275fac=function(r){return new(r||t)(a(v),a(F),a(X),a(Y))},t.\u0275prov=f({token:t,factory:t.\u0275fac});let e=t;return e})();function ot(e={state:void 0},[t,s]){let{state:n}=e;return{state:s(n,t),action:t}}var it=[Ae,{provide:A,useExisting:Ae}],I=(()=>{let t=class t extends T{constructor(n,r,o){super(),this.actionsObserver=r,this.reducerManager=o,this.source=n,this.state=n.state}select(n,...r){return ut.call(null,n,...r)(this)}selectSignal(n,r){return j(()=>n(this.state()),r)}lift(n){let r=new t(this,this.actionsObserver,this.reducerManager);return r.operator=n,r}dispatch(n){this.actionsObserver.next(n)}next(n){this.actionsObserver.next(n)}error(n){this.actionsObserver.error(n)}complete(){this.actionsObserver.complete()}addReducer(n,r){this.reducerManager.addReducer(n,r)}removeReducer(n){this.reducerManager.removeReducer(n)}};t.\u0275fac=function(r){return new(r||t)(a(A),a(v),a(U))},t.\u0275prov=f({token:t,factory:t.\u0275fac});let e=t;return e})(),ct=[I];function ut(e,t,...s){return function(r){let o;if(typeof e=="string"){let i=[t,...s].filter(Boolean);o=r.pipe(ae(e,...i))}else if(typeof e=="function")o=r.pipe(ce(i=>e(i,t)));else throw new TypeError(`Unexpected type '${typeof e}' in select operator, expected 'string' or 'function'`);return o.pipe(ue())}}var ee="https://ngrx.io/guide/store/configuration/runtime-checks";function Oe(e){return e===void 0}function ke(e){return e===null}function qe(e){return Array.isArray(e)}function at(e){return typeof e=="string"}function lt(e){return typeof e=="boolean"}function dt(e){return typeof e=="number"}function Ke(e){return typeof e=="object"&&e!==null}function ft(e){return Ke(e)&&!qe(e)}function pt(e){if(!ft(e))return!1;let t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}function J(e){return typeof e=="function"}function ht(e){return J(e)&&e.hasOwnProperty("\u0275cmp")}function gt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function yt(e){return e instanceof c?u(e):e}function mt(e,t){return t.map((s,n)=>{if(e[n]instanceof c){let r=u(e[n]);return{key:s.key,reducerFactory:r.reducerFactory?r.reducerFactory:W,metaReducers:r.metaReducers?r.metaReducers:[],initialState:r.initialState}}return s})}function Rt(e){return e.map(t=>t instanceof c?u(t):t)}function Be(e){return typeof e=="function"?e():e}function St(e,t){return e.concat(t)}function vt(){if(u(I,{optional:!0,skipSelf:!0}))throw new TypeError("The root Store has been provided more than once. Feature modules should provide feature states instead.");return"guarded"}function bt(e,t){return function(s,n){let r=t.action(n)?G(n):n,o=e(s,r);return t.state()?G(o):o}}function G(e){Object.freeze(e);let t=J(e);return Object.getOwnPropertyNames(e).forEach(s=>{if(!s.startsWith("\u0275")&&gt(e,s)&&(!t||s!=="caller"&&s!=="callee"&&s!=="arguments")){let n=e[s];(Ke(n)||J(n))&&!Object.isFrozen(n)&&G(n)}}),e}function Et(e,t){return function(s,n){if(t.action(n)){let o=H(n);Ce(o,"action")}let r=e(s,n);if(t.state()){let o=H(r);Ce(o,"state")}return r}}function H(e,t=[]){return(Oe(e)||ke(e))&&t.length===0?{path:["root"],value:e}:Object.keys(e).reduce((n,r)=>{if(n)return n;let o=e[r];return ht(o)?n:Oe(o)||ke(o)||dt(o)||lt(o)||at(o)||qe(o)?!1:pt(o)?H(o,[...t,r]):{path:[...t,r],value:o}},!1)}function Ce(e,t){if(e===!1)return;let s=e.path.join("."),n=new Error(`Detected unserializable ${t} at "${s}". ${ee}#strict${t}serializability`);throw n.value=e.value,n.unserializablePath=s,n}function Ft(e,t){return function(s,n){if(t.action(n)&&!ge.isInAngularZone())throw new Error(`Action '${n.type}' running outside NgZone. ${ee}#strictactionwithinngzone`);return e(s,n)}}function It(e){return ye()?l({strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!0,strictActionImmutability:!0,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1},e):{strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!1,strictActionImmutability:!1,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1}}function Tt({strictActionSerializability:e,strictStateSerializability:t}){return s=>e||t?Et(s,{action:n=>e&&!te(n),state:()=>t}):s}function jt({strictActionImmutability:e,strictStateImmutability:t}){return s=>e||t?bt(s,{action:n=>e&&!te(n),state:()=>t}):s}function te(e){return e.type.startsWith("@ngrx")}function wt({strictActionWithinNgZone:e}){return t=>e?Ft(t,{action:s=>e&&!te(s)}):t}function xt(e){return[{provide:xe,useValue:e},{provide:we,useFactory:Ut,deps:[xe]},{provide:E,deps:[we],useFactory:It},{provide:w,multi:!0,deps:[E],useFactory:jt},{provide:w,multi:!0,deps:[E],useFactory:Tt},{provide:w,multi:!0,deps:[E],useFactory:wt}]}function Je(){return[{provide:Q,multi:!0,deps:[E],useFactory:At}]}function Ut(e){return e}function At(e){if(!e.strictActionTypeUniqueness)return;let t=Object.entries(K).filter(([,s])=>s>1).map(([s])=>s);if(t.length)throw new Error(`Action types are registered more than once, ${t.map(s=>`"${s}"`).join(", ")}. ${ee}#strictactiontypeuniqueness`)}function nn(e,t,s={}){return N([...Mt(e,t,s),_t])}function Ot(e={},t={}){return[{provide:Me,useFactory:vt},{provide:Se,useValue:t.initialState},{provide:Y,useFactory:Be,deps:[Se]},{provide:z,useValue:e},{provide:Ee,useExisting:e instanceof c?e:z},{provide:$e,deps:[z,[new _(Ee)]],useFactory:yt},{provide:Te,useValue:t.metaReducers?t.metaReducers:[]},{provide:je,deps:[w,Te],useFactory:St},{provide:ve,useValue:t.reducerFactory?t.reducerFactory:W},{provide:Ne,deps:[ve,je],useFactory:ze},Xe,rt,st,it,ct,xt(t.runtimeChecks),Je()]}function kt(){u(v),u(F),u(X),u(I),u(Me,{optional:!0}),u(Q,{optional:!0})}var Ct=[{provide:B,useFactory:kt},{provide:M,multi:!0,useFactory(){return()=>u(B)}}];function rn(e,t){return N([...Ot(e,t),Ct])}function Dt(){u(B);let e=u(Le),t=u(Pe),s=u(U);u(Q,{optional:!0});let n=e.map((r,o)=>{let h=t.shift()[o];return p(l({},r),{reducers:h,initialState:Be(r.initialState)})});s.addFeatures(n)}var _t=[{provide:Ue,useFactory:Dt},{provide:M,multi:!0,useFactory(){return()=>u(Ue)}}];function Mt(e,t,s={}){return[{provide:Fe,multi:!0,useValue:e instanceof Object?{}:s},{provide:be,multi:!0,useValue:{key:e instanceof Object?e.name:e,reducerFactory:!(s instanceof c)&&s.reducerFactory?s.reducerFactory:W,metaReducers:!(s instanceof c)&&s.metaReducers?s.metaReducers:[],initialState:!(s instanceof c)&&s.initialState?s.initialState:void 0}},{provide:Le,deps:[Fe,be],useFactory:mt},{provide:q,multi:!0,useValue:e instanceof Object?e.reducer:t},{provide:Ie,multi:!0,useExisting:t instanceof c?t:q},{provide:Pe,multi:!0,deps:[q,[new _(Ie)]],useFactory:Rt},Je()]}function b(...e){let t=e.pop(),s=e.map(n=>n.type);return{reducer:t,types:s}}function Ge(e,...t){let s=new Map;for(let n of t)for(let r of n.types){let o=s.get(r);if(o){let i=(h,d)=>n.reducer(o(h,d),d);s.set(r,i)}else s.set(r,n.reducer)}return function(n=e,r){let o=s.get(r.type);return o?o(n,r):n}}var O=S("[Users] Build User Session"),He=S("[Users] Build User Session Success",Z()),Ze=S("[Users] Build User Session Failed"),k=S("[Users] User Session Logout"),C=S("[Users] User Session Login",Z());var Qe="users",Nt={user:null,isAuthenticated:!1},$t=Ge(Nt,b(O,e=>l({},e)),b(He,(e,t)=>p(l({},e),{user:t.user,isAuthenticated:!0})),b(Ze,e=>p(l({},e),{user:null,isAuthenticated:!1})),b(k,e=>p(l({},e),{user:null,isAuthenticated:!1})),b(C,(e,t)=>p(l({},e),{user:t.user,isAuthenticated:!0})));function an(e,t){return $t(e,t)}var We=(()=>{let t=class t{constructor(){this.store=u(I),this.currentUser$=this.store.select(Qe)}buildUserSession(){this.store.dispatch(O())}userSessionLogout(){this.store.dispatch(k())}userSessionLogin(n){this.store.dispatch(C({user:n}))}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=f({token:t,factory:t.\u0275fac});let e=t;return e})();var Sn=(()=>{let t=class t{constructor(n,r){this.http=n,this.usersFacade=r,this._loggedInUser$=new R(this.getToken()),this.loggedInUser$=this._loggedInUser$.asObservable(),this._isFastLogin$=new R(this.getLoginFastStorage()),this.isFastLogin$=this._isFastLogin$.asObservable(),this.apiUrl=Re.API_URL}login({email:n,password:r}){return this.http.post(`${this.apiUrl}users/login`,{email:n,password:r})}logout(){localStorage.removeItem("jwtToken"),this._loggedInUser$.next(null),this._isFastLogin$.value&&(localStorage.removeItem("isFastLogin"),this._isFastLogin$.next(!1))}logoutNgShop(){this.usersFacade.userSessionLogout()}loginNgShop(n){this.usersFacade.userSessionLogin(n)}loginFast(n){return this.http.post(`${this.apiUrl}users/fast-login/${n}`,"")}getLoginFastStorage(){return JSON.parse(localStorage.getItem("isFastLogin")||"false")}getIsLoginFast(){return this._isFastLogin$.value}setIsLoginFast(n){this._isFastLogin$.next(n),localStorage.setItem("isFastLogin",JSON.stringify(n))}saveTokenLoginFast(n){let r=atob(n.split(".")[1]),o=JSON.parse(r);this.isTokenExpried(o.exp)||localStorage.setItem("jwtToken",n)}saveTokenAdminPanel(n){return JSON.parse(atob(n.split(".")[1])).isAdmin?(localStorage.setItem("jwtToken",n),this._loggedInUser$.next(n),!0):!1}saveTokenNgShop(n){let r=atob(n.split(".")[1]),o=JSON.parse(r);this.isTokenExpried(o.exp)||localStorage.setItem("jwtToken",n)}getToken(){return localStorage.getItem("jwtToken")}getUserIdFromToken(){let n=this.getToken();if(n){let r=JSON.parse(atob(n.split(".")[1]));return r?r.userId:null}return null}isValidToken(){let n=this.getToken();if(n){let r=JSON.parse(atob(n.split(".")[1]));return!this.isTokenExpried(r)}else return!1}isTokenExpried(n){return Math.floor(new Date().getTime()/1e3)>=n}get loggedInUser(){return this._loggedInUser$.value}};t.\u0275fac=function(r){return new(r||t)(a(me),a(We))},t.\u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();export{S as a,B as b,Ue as c,X as d,I as e,nn as f,rn as g,O as h,He as i,Ze as j,k,Qe as l,an as m,We as n,Sn as o};
